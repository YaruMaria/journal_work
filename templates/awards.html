<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞–≥—Ä–∞–¥—ã —É—á–µ–Ω–∏–∫–∞</title>
    <style>
        .month-slider {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 20px 0;
            scroll-behavior: smooth;
        }
        .month-card {
            min-width: 100px;
            text-align: center;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            background: #f5f5f5;
        }
        .month-card.current {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }
        .award-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        .award-option {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 20px;
        }
        .award-1 { background: gold; }
        .award-2 { background: silver; }
        .award-3 { background: #cd7f32; } /* –±—Ä–æ–Ω–∑–∞ */
        .award-4 { background: #ff6b6b; color: white; }
        .selected-award {
            border: 3px solid black;
            transform: scale(1.1);
        }
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>–ù–∞–≥—Ä–∞–¥—ã —É—á–µ–Ω–∏–∫–∞: {{ student[1] }}</h1>

    <div class="nav-buttons">
        <a href="{{ url_for('student', student_id=student[0]) }}">‚Üê –ù–∞–∑–∞–¥ –∫ —É—á–µ–Ω–∏–∫—É</a>
    </div>

    <div class="month-slider" id="monthSlider">
        {% for m in months %}
        <div class="month-card {% if m.current %}current{% endif %}"
             onclick="loadMonth({{ m.year }}, {{ m.month }}, {{ awards.get((m.year, m.month), 0 }})">
            <h3>{{ m.name }}</h3>
            <p>{{ m.year }}</p>
            {% if (m.year, m.month) in awards %}
                {% set award = awards[(m.year, m.month)] %}
                <div style="font-size: 24px;">
                    {% if award == 1 %}üèÜ{% endif %}
                    {% if award == 2 %}ü•à{% endif %}
                    {% if award == 3 %}ü•â{% endif %}
                    {% if award == 4 %}‚ùå{% endif %}
                </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <div id="awardSelection" style="display: none;">
        <h2 id="selectedMonthTitle"></h2>
        <div class="award-options">
            <div class="award-option award-1" onclick="selectAward(1)">üèÜ</div>
            <div class="award-option award-2" onclick="selectAward(2)">ü•à</div>
            <div class="award-option award-3" onclick="selectAward(3)">ü•â</div>
            <div class="award-option award-4" onclick="selectAward(4)">‚ùå</div>
        </div>
    </div>

    <script>
        let currentYear, currentMonth, currentAward;

        function loadMonth(year, month, award) {
            currentYear = year;
            currentMonth = month;
            currentAward = award || 0;

            document.getElementById('selectedMonthTitle').textContent =
                `–í—ã–±—Ä–∞–Ω –º–µ—Å—è—Ü: ${monthName(month)} ${year}`;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫ –≤—ã–±–æ—Ä–∞ –Ω–∞–≥—Ä–∞–¥—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
            const now = new Date();
            const isCurrent = (year === now.getFullYear() && month === now.getMonth() + 1);
            document.getElementById('awardSelection').style.display = isCurrent ? 'block' : 'none';

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            document.querySelectorAll('.award-option').forEach(el => {
                el.classList.remove('selected-award');
            });

            // –í—ã–¥–µ–ª—è–µ–º —Ç–µ–∫—É—â—É—é –Ω–∞–≥—Ä–∞–¥—É, –µ—Å–ª–∏ –µ—Å—Ç—å
            if (currentAward > 0) {
                document.querySelector(`.award-${currentAward}`).classList.add('selected-award');
            }
        }

        function selectAward(award) {
            currentAward = award;

            // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
            document.querySelectorAll('.award-option').forEach(el => {
                el.classList.remove('selected-award');
            });
            document.querySelector(`.award-${award}`).classList.add('selected-award');

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –±–∞–∑—É
            fetch('/update_award', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `student_id={{ student[0] }}&year=${currentYear}&month=${currentMonth}&award=${award}`
            }).then(response => response.json())
              .then(data => {
                  if (data.status === 'success') {
                      location.reload(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤—É—é –Ω–∞–≥—Ä–∞–¥—É
                  }
              });
        }

        function monthName(month) {
            const names = ['–Ø–Ω–≤–∞—Ä—å', '–§–µ–≤—Ä–∞–ª—å', '–ú–∞—Ä—Ç', '–ê–ø—Ä–µ–ª—å', '–ú–∞–π', '–ò—é–Ω—å',
                          '–ò—é–ª—å', '–ê–≤–≥—É—Å—Ç', '–°–µ–Ω—Ç—è–±—Ä—å', '–û–∫—Ç—è–±—Ä—å', '–ù–æ—è–±—Ä—å', '–î–µ–∫–∞–±—Ä—å'];
            return names[month - 1];
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            const now = new Date();
            loadMonth(now.getFullYear(), now.getMonth() + 1, 0);
        };
    </script>
</body>
</html>